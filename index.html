<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/podcast.css">
    <script src="js/dom-to-image.min.js"></script>
    <script>
        
        let edition;
        let title;
        let titleSize;
        let subtitle;
        let subtitleSize;
        let date;
        let time;

        const setValues = () => {
            edition = "S2E7";
            title = "al abordaje mina-san";
            titleSize = 18;
            subtitle = "tatakae arturo-kun";
            subtitleSize = 30;
            date = new Date();
            time = "21:30";
        };

        const setInputs = () => {
            document.getElementsByName("title-size")[0].value = titleSize;
            document.getElementsByName("subtitle-size")[0].value = subtitleSize;
            document.getElementsByName("edition")[0].value = edition;
            document.getElementsByName("date")[0].value = date.toLocaleDateString("fr-CA", {year: "numeric", month: "2-digit", day: "2-digit"});
            document.getElementsByName("time")[0].value = time;
        };

        const fill = () => {
            document.getElementById("edition").innerHTML = edition.toLowerCase();
            document.getElementById("title").innerHTML = title.toLowerCase();
            document.getElementById("title").style.fontSize = (titleSize/10)+"rem";
            document.getElementById("subtitle").innerHTML = subtitle.toLowerCase();
            document.getElementById("subtitle").style.fontSize = (subtitleSize/10)+"rem";
            document.getElementById("day-name").innerHTML = date.toLocaleDateString("es-CL", {weekday: "short"}).substr(0, 3);
            document.getElementById("day-number").innerHTML = date.toLocaleDateString("es-CL", {day: "2-digit"});
            document.getElementById("month").innerHTML = date.toLocaleDateString("es-CL", {month: "short"}).substr(0, 3);
            document.getElementById("time").innerHTML = time;
        };

        const convert = () => {
            const toConvert = document.getElementById("to-convert");
            domtoimage.toPng(toConvert).then(
                function (dataUrl) {
                    var img = new Image();
                    img.src = dataUrl;

                    var link = document.createElement("a");
                    link.download = "afiche_podcast_"+edition;
                    link.href = dataUrl;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    delete link;

                    document.getElementById("error").style.display = "none";
                }
            ).catch(
                function (error) {
                    document.getElementById("error").style.display = "block";
                    document.getElementById("error").innerHTML = error;
                }
            );
        };

        const updateTitle = () => {
            title = String(document.getElementsByName("title")[0].value);
            fill();
        };
        const updateTitleSize = () => {
            titleSize = parseInt(document.getElementsByName("title-size")[0].value);
            fill();
        };
        const updateSubtitle = () => {
            subtitle = String(document.getElementsByName("subtitle")[0].value);
            fill();
        };
        const updateSubtitleSize = () => {
            subtitleSize = parseInt(document.getElementsByName("subtitle-size")[0].value);
            fill();
        };
        const updateEdition = () => {
            edition = String(document.getElementsByName("edition")[0].value);
            fill();
        };
        const updateDate = () => {
            date = new Date(document.getElementsByName("date")[0].value + " 00:00:00");
            fill();
        };
        const updateTime = () => {
            time = document.getElementsByName("time")[0].value;
            fill();
        };
    </script>
    <title>Afiche Podcast Maker</title>
</head>
<body onload="setValues();setInputs();fill();">
    <div class="main">
        <div id="to-convert" class="bg">
            <div class="layer">
                <div class="squares-container">
                    <div class="squares-grid">
                        <div class="square-container"><div class="square m"></div></div>
                        <div class="square-container"><div class="square l"></div></div>
                        <div class="square-container"><div class="square m"></div></div>
        
                        <div class="square-container"><div class="square s"></div></div>
                        <div class="square-container"><div class="square m"></div></div>
                        <div class="square-container"><div class="square l"></div></div>
        
                        <div class="square-container"><div class="square l"></div></div>
                        <div class="square-container"><div class="square m"></div></div>
                        <div class="square-container"><div class="square s"></div></div>
        
                        <div class="square-container"><div class="square s"></div></div>
                        <div class="square-container"><div class="square l"></div></div>
                        <div class="square-container"><div class="square m"></div></div>
                    </div>
                </div>
            </div>
            <div class="layer">
                <div class="image-container">
                    <img src="img/chibitantan1.png" width=900 alt="chibitan">
                </div>
            </div>
            <div class="layer">
                <div class="footer-container">
                    <div class="footer">
                        <div class="footer-links-container">
                            <div class="footer-link">
                                <img src="img/TwitchGlitchWhite.svg" width=50 height=50 alt="twitch">
                                <span class="footer-link-text">/seishin_tan</span>
                            </div>
                            <div class="footer-link">
                                <img src="img/Spotify_Logo_RGB_White.png" width=50 height=50 alt="twitch">
                                <span class="footer-link-text">> podukasuto</span>
                            </div>
                        </div>
                        <div class="logo-container">
                            <img src="img/logo.svg" height=60 alt="twitch">
                        </div>
                    </div>
                </div>
            </div>
            <div class="layer">
                <div class="edition-container">
                    <span class="edition" id="edition"></span>
                </div>
            </div>
            <div class="layer">
                <div class="text-bubble title">
                    <div class="prime-container">
                        <div class="prime">
                            <span>¡suscríbete con twitch prime!</span>
                        </div>
                    </div>
                    <div class="text-bubble-content">
                        <span class="text">podukasuto</span>
                        <div class="title-container">
                            <span class="title" id="title"></span>
                            <span class="subtitle" id="subtitle"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="layer">
                <div class="text-bubble date">
                    <div class="text-bubble-content">
                        <div class="fulldate-container">
                            <span id="day-name" class="date"></span>
                            <div class="date-container">
                                <span id="day-number" class="day"></span>
                                <span id="month" class="date"></span>
                            </div>
                            <span id="time" class="date borderleft"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="inputs-container">
            <div class="input-row">
                <span>Título</span><input name="title" type="text" onchange="updateTitle()">
                <span>Tamaño</span><input class="s" name="title-size" type="number" onchange="updateTitleSize()">
            </div>
            <div class="input-row">
                <span>Subtítulo</span><input name="subtitle" type="text" onchange="updateSubtitle()">
                <span>Tamaño</span><input class="s" name="subtitle-size" type="number" onchange="updateSubtitleSize()">
            </div>
            <div class="input-row">
                <span>Edición</span><input name="edition" type="text" onchange="updateEdition()">
            </div>
            <div class="input-row">
                <span>Fecha</span><input name="date" type="date" onchange="updateDate()">
            </div>
            <div class="input-row">
                <span>Hora</span><input name="time" type="time" onchange="updateTime()">
            </div>
            <div class="download-container">
                <button name="download" onclick="convert()">Descargar</button>
            </div>
        </div>
    </div>
</body>
</html>